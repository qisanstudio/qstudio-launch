# -*- coding: utf-8 -*-
from __future__ import unicode_literals

from flask import flash
from wtforms import validators
from flask.ext.admin.contrib.sqla import ModelView
from studio.core.engines import db
from aboutme.models import NaviModel, ChannelModel, ArticleModel

from .forms import CKTextAreaField


class Navi(ModelView):

    column_labels = {'name': '名称', 'name': '名称'}

    def __init__(self, **kwargs):
        super(Navi, self).__init__(NaviModel, db.session, **kwargs)
    
    def create_form(self, obj=None):
        form = super(Navi, self).create_form()
        delattr(form, 'channels')
        delattr(form, 'date_created')
        return form

    def edit_form(self, obj=None):
        form = super(Navi, self).edit_form()
        delattr(form, 'channels')
        delattr(form, 'date_created')
        return form


class Channel(ModelView):

    create_template = 'panel/channel_edit.html'
    edit_template = 'panel/channel_edit.html'
    column_labels = {'name': '名称', 
                     'parent': '主分类(本身为主分类，不填写)', 
                     'summary': '简介'}
    column_searchable_list = ['name', ]
    column_default_sort = ('date_created', True)
    form_extra_fields = {
        'summary': CKTextAreaField('简介', validators=[validators.Required()]),
    }

    def __init__(self, **kwargs):
        super(Channel, self).__init__(ChannelModel, db.session, **kwargs)

    def create_form(self, obj=None):
        form = super(Channel, self).create_form()
        delattr(form, 'articles')
        delattr(form, 'channels')
        delattr(form, 'all_articles')
        delattr(form, 'date_created')
        return form

    def edit_form(self, obj=None):
        form = super(Channel, self).edit_form()
        delattr(form, 'articles')
        delattr(form, 'channels')
        delattr(form, 'all_articles')
        delattr(form, 'date_created')
        return form
